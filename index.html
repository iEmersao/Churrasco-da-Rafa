<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Churras da Rafa</title>
  <style>
    body {
      margin: 0;
      font-family: "Segoe UI", sans-serif;
      background: url('https://images.unsplash.com/photo-1555992336-cbf97e6f2c36?auto=format&fit=crop&w=1200&q=80') center/cover no-repeat fixed;
      padding: 0;
      color: #fff;
    }
    .bg-video { position: fixed; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; z-index: -1; filter: brightness(60%); }
    .overlay { background: rgba(0,0,0,0.55); width: 100%; min-height: 100vh; padding: 20px; position: relative; z-index: 1; }
    .container { max-width: 700px; margin: auto; background: rgba(0,0,0,0.65); padding: 25px; border-radius: 15px; box-shadow: 0 0 20px rgba(0,0,0,0.6); }
    h1 { text-align: center; font-size: 2.2rem; margin-bottom: 10px; color: #ffb347; }
    .info { font-size: 1.1rem; margin-bottom: 20px; line-height: 1.6; }
    label { font-weight: bold; font-size: 1.1rem; display:block; margin-top:8px; }
    input, select, textarea { width: 100%; padding: 10px; border-radius: 8px; border: none; margin-top: 6px; margin-bottom: 15px; font-size: 1rem; }
    button { width: 100%; background: #ff9100; border: none; padding: 12px; color: #fff; font-size: 1.1rem; border-radius: 8px; cursor: pointer; margin-bottom: 20px; transition: 0.2s; }
    button:hover { background: #ffa733; }
    .card { background: rgba(255,255,255,0.12); padding: 15px; border-radius: 10px; margin-bottom: 12px; position: relative; color: #fff; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
    .item { animation: fadeIn 0.35s ease forwards; }
    @media (max-width: 600px) { h1 { font-size: 1.6rem; } .container { padding: 15px; } button { font-size: 1rem; padding: 10px; } }
    .countdown { text-align: center; font-size: 1.2rem; margin-bottom: 20px; }
    .audio-tip { text-align: center; margin: 15px 0; color: #ffb347; font-size: 1rem; }
    .small-muted { font-size: 0.9rem; opacity: 0.9; }
  </style>
</head>
<body>

  <!-- VÃ­deo de fundo -->
  <video class="bg-video" autoplay loop muted playsinline aria-hidden="true">
    <source src="https://cdn.videvo.net/videvo_files/video/free/2014-12/large_watermarked/Hands_Beer04Videvo_preview.mp4" type="video/mp4">
  </video>

  <div class="overlay">
    <div class="container">
      <h1>ğŸ”¥ ChurrascÃ£o da Rafa</h1>

      <div class="countdown" id="countdown">â³ Faltam ...</div>

      <div class="info" aria-live="polite">
        ğŸ“ <strong>EndereÃ§o:</strong> Rua Georgina de Albuquerque, 196<br>
        ğŸ“… <strong>Data:</strong> 13 de Dezembro<br>
        â° <strong>HorÃ¡rio:</strong> A partir das 19h<br><br>
        Traga sua bebida de preferencia! ğŸ˜„ğŸ»ğŸ”¥
      </div>

      <!-- Mapa do local -->
      <iframe src="https://www.google.com/maps?q=Rua+Georgina+de+Albuquerque,+196&amp;output=embed"
              width="100%" height="250" style="border:0; border-radius:10px; margin-bottom:20px;" allowfullscreen="" loading="lazy" title="Mapa do local">
      </iframe>

      <!-- MÃºsica brasileira -->
      <audio id="musica" loop preload="metadata">
        <source src="samba.mp3" type="audio/mpeg">
        Seu navegador nÃ£o suporta Ã¡udio.
      </audio>
      <div class="audio-tip">
        ğŸµ Da play ae:
        <button type="button" id="play-music-btn">â–¶ï¸ Play MÃºsica</button>
      </div>

      <label for="nome">Seu nome:</label>
      <input type="text" id="nome" placeholder="Digite seu nome" autocomplete="name" />

      <label for="presenca">VocÃª vai?</label>
      <select id="presenca" aria-label="PresenÃ§a">
        <option value="Sim">Sim! TÃ´ dentro ğŸ˜ğŸ”¥</option>
        <option value="NÃ£o">NÃ£o vou conseguir ir ğŸ˜”</option>
      </select>

      <label for="recado">Deixe um recado:</label>
      <textarea id="recado" rows="3" placeholder="Ex: Chego mais tarde..."></textarea>

      <button type="button" id="confirm-btn">Confirmar PresenÃ§a</button>

      <h2 style="margin-bottom:10px;">ConfirmaÃ§Ãµes (<span id="contador">0</span>)</h2>
      <div id="lista" aria-live="polite" class="small-muted"></div>
    </div>
  </div>

  <!-- Firebase + lÃ³gica (cole tudo isso no final do body) -->
  <script type="module">
    // Imports Firebase (versÃ£o compatÃ­vel com mÃ³dulos)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import {
      getFirestore,
      collection,
      addDoc,
      onSnapshot,
      serverTimestamp,
      query,
      orderBy
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // --- CONFIGURAÃ‡ÃƒO (jÃ¡ fornecida por vocÃª) ---
    const firebaseConfig = {
      apiKey: "AIzaSyAHP64jj8-5saOazBuRI1BH43DnV4QsljQ",
      authDomain: "churras-rafa.firebaseapp.com",
      projectId: "churras-rafa",
      storageBucket: "churras-rafa.firebasestorage.app",
      messagingSenderId: "311070733036",
      appId: "1:311070733036:web:a5743ee2011ccf1d342bc9",
      measurementId: "G-3C3WJVFYMX"
    };

    // Inicializa Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // ReferÃªncia da coleÃ§Ã£o "presencas" ordenada pelo timestamp
    const presencasRef = collection(db, "presencas");
    const presencasQuery = query(presencasRef, orderBy("timestamp", "asc"));

    // FunÃ§Ã£o segura para criar card (sem innerHTML)
    function criarCardObjeto(obj) {
      const card = document.createElement("div");
      card.className = "card item";

      const linhaTopo = document.createElement("div");
      const nomeEl = document.createElement("strong");
      nomeEl.textContent = obj.nome || "â€”";
      linhaTopo.appendChild(nomeEl);

      const presencaEl = document.createElement("em");
      presencaEl.style.marginLeft = "8px";
      presencaEl.textContent = `â€” ${obj.presenca || ""}`;
      linhaTopo.appendChild(presencaEl);

      const recadoEl = document.createElement("p");
      recadoEl.className = "small-muted";
      recadoEl.style.marginTop = "8px";
      recadoEl.textContent = obj.recado || "";

      card.appendChild(linhaTopo);
      card.appendChild(recadoEl);

      return card;
    }

    // Elementos do DOM
    const listaEl = document.getElementById("lista");
    const contadorEl = document.getElementById("contador");

    // Escuta em tempo real: toda alteraÃ§Ã£o na coleÃ§Ã£o aparece para todo mundo
    onSnapshot(presencasQuery, (snapshot) => {
      listaEl.innerHTML = "";
      contadorEl.innerText = snapshot.size;

      snapshot.forEach((doc) => {
        const data = doc.data();
        listaEl.appendChild(criarCardObjeto(data));
      });
    }, (erro) => {
      console.error("Erro ao escutar presenÃ§as:", erro);
      listaEl.innerText = "Erro ao carregar confirmaÃ§Ãµes.";
    });

    // FunÃ§Ã£o para confirmar presenÃ§a (adiciona doc)
    async function confirmar() {
      const nome = document.getElementById("nome").value.trim();
      const presenca = document.getElementById("presenca").value;
      const recado = document.getElementById("recado").value.trim();
      const emojis = ["ğŸ–", "ğŸº", "ğŸ¶", "ğŸ”¥", "ğŸ˜„", "ğŸ¥©", "ğŸ‰"];

      if (!nome) {
        alert("Coloca seu nome aÃ­, pÃ´! ğŸ˜„");
        return;
      }

      try {
        await addDoc(presencasRef, {
          nome,
          presenca,
          recado,
          timestamp: serverTimestamp()
        });

        // Limpa inputs apÃ³s envio
        document.getElementById("nome").value = "";
        document.getElementById("recado").value = "";

        alert(`ğŸ‰ PresenÃ§a confirmada! Valeu por avisar ${emojis[Math.floor(Math.random()*emojis.length)]}`);
      } catch (err) {
        console.error("Erro ao salvar presenÃ§a:", err);
        alert("Ocorreu um erro ao confirmar. Tente novamente.");
      }
    }

    // Contagem regressiva (ajusta fuso automaticamente)
    function atualizarContagemRegressiva() {
      const evento = new Date("2025-12-13T19:00:00");
      const agora = new Date();
      const diff = evento - agora;
      const el = document.getElementById("countdown");

      if (diff <= 0) {
        el.innerText = "ğŸ‰ JÃ¡ comeÃ§ou!";
        return;
      }

      const dias = Math.floor(diff / (1000 * 60 * 60 * 24));
      const horas = Math.floor((diff / (1000 * 60 * 60)) % 24);
      const minutos = Math.floor((diff / (1000 * 60)) % 60);
      const segundos = Math.floor((diff / 1000) % 60);

      el.innerText = `â³ Faltam ${dias}d ${horas}h ${minutos}m ${segundos}s`;
    }

    // MÃºsica (evita autoplay bloqueado)
    function playMusica() {
      const musica = document.getElementById("musica");
      function tentar() {
        try {
          if (typeof musica.duration === "number" && musica.duration > 0) {
            musica.currentTime = Math.min(30, musica.duration);
          } else {
            musica.currentTime = 0;
          }
        } catch (e) {}
        musica.play().catch(() => {
          alert("Seu navegador bloqueou o Ã¡udio. Tente clicar novamente.");
        });
      }

      if (!isFinite(musica.duration) || musica.duration === 0) {
        musica.addEventListener("loadedmetadata", tentar, { once: true });
      } else {
        tentar();
      }
    }

    // Listeners
    document.getElementById("confirm-btn").addEventListener("click", confirmar);
    document.getElementById("play-music-btn").addEventListener("click", playMusica);

    // Inicia contagem
    atualizarContagemRegressiva();
    setInterval(atualizarContagemRegressiva, 1000);
  </script>
</body>
</html>
